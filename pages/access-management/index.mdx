import { Callout } from 'nextra-theme-docs'

# Access Management

## Introduction

Imagine you're the owner of a club, and you decide who gets to enter and what they can do inside. **Access Management** for SaaS applications works similarly – it controls who enters an application and their actions inside. In our context, these rules are called [**roles**](/access-management#roles) and [**permissions**](/access-management#permissions).

With ROQ's access management system, you can:

* Specify roles (e.g., _admin_, _member_, _clerk_).
* Assign these roles to users.
* Decide what each role allows – maybe viewing certain pages, or pressing specific buttons.
* Control what data each role can see.
* Set permissions and apply them to the application.

## The Big Picture

The entire ROQ system works in a coordinated manner to ensure seamless access management.

Imagine the ROQ system as a secure club where members get special access based on their membership cards. 

- **Membership Desk (ROQ Console)**: At this desk, members get their cards that determine where they can go and what they can do inside the club. This card-giving process is like assigning roles and permissions in the system, which decides what each user can see and do.

- **Tailored Club Experience (Database Interaction & User Customization)**: Just as club staff check your card before letting you into VIP areas or offering special services, the ROQ system ensures users see only what their roles allow. Think of it as having doors within the club that only open for specific cards, making sure members have a unique experience tailored to their privileges.

- **Super-Efficient Clerk (AI-Assistant)**: Instead of manually selecting what each card can do, imagine a smart clerk at the desk who quickly gives out the best membership cards based on common choices. This is like ROQ's AI Assistant, which auto-sets user roles and permissions based on predefined templates to make things quicker and easier.

In summary, ROQ's access management is like a high-tech club where your membership card determines your access and experience. Combines the power of user-configured roles and permissions with an AI-driven automatic setup to deliver a robust, flexible, and efficient access management system.


{/*
The entire system works in a coordinated manner to ensure seamless access management. Here's how all the components fit together: 

In the ROQ Console, users configure roles and permissions. These are integral in defining user access rights and restrictions within the application.

Simultaneously, every database query within the project is supplemented with conditions derived from the user's roles and permissions. This means that each user's interaction with the database is customized based on their specific access rights, thereby ensuring a secure and controlled data environment.

To streamline the process and minimize manual intervention, the AI Assistant provides an auto-configuration feature. This advanced functionality allows for an automatic setup of roles and permissions based on predefined templates, significantly reducing the time and effort required in the initial configuration.

In essence, ROQ's access management combines the power of user-configured roles and permissions with an AI-driven automatic setup to deliver a robust, flexible, and efficient access management system.
*/}

## How It Works

Using our previous analogy, imagine you're at the entrance of our high-tech club, the ROQ Club and let's explore how access management comes to life in a familiar setting.

### 🎫 Membership Desk ([ROQ Console](https://console.roq.tech/))

The [ROQ Console](https://console.roq.tech/) is like the club's Membership Desk. Here, various membership cards (roles and permissions) are crafted. 

Just as a VIP card might grant its holder special privileges in a club, permissions in ROQ define what actions a user can perform. When setting up these permissions, you're essentially deciding what doors or areas each membership card can access – be it all rooms (`all` records), just their reserved lounge (`own` records), or spaces exclusive to their group or friends (`tenant`). 

### 🚪 Access Throughout the Club
With card in hand, your experience within the club is personalized. ROQ ensures that the boundaries set by each card are respected throughout the club, from the bar to the VIP lounge, including its various rooms and services (UI Components and APIs).

### 🎉 Customizing Your Club Night

Remember, you can also customize the club's rules (permissions) to fit the unique theme of your event (project)!

<Callout type="info">
For more information on how to set up permissions for your project, please refer to the documentation on [Project Permissions](/access-management/project-permissions).
</Callout>

### 🔧 Behind the Scenes: Club's Tech

Dive deeper into the club's operations:

On a more technical note, our club uses an advanced system, it's called a **Query Plans**, that instantly knows what each member is allowed to do based on their membership card.

While the details of all members and their activities are stored securely in a central system, that is the database, individual terminals at the club (your application) only access and display relevant details to each member, ensuring a personalized experience.

The best part? The club doesn't need to know everything happening in real-time. It only requires the layout (schema) of your event. The real interactions or queries happen in real-time, right on the dance floor (on your side).

<Callout type="info">
"On your side" emphasizes that these real-time interactions occur directly in your application environment rather than on the ROQ platform.
</Callout>


{/*

Roles and permissions are defined in the [ROQ Console](https://console.roq.tech/). Generally, permissions grant access to objects, e.g., _a customer is allowed to make an order_. You can specify the operation (read, create, update, and delete) and set the scope. The scope determines if a user has access to either `all` records, only the `own` records, or to records related to the own account (~ `tenant`). These permissions are automatically enforced on all UI Components and APIs of ROQ and can also be applied to the project's user interface and queries.

<Callout type="info" emoji="ℹ️">
You can also define permissions that are applied to your project!
</Callout>

{ /* Some steps of preparation are needed. First, you must declare your custom domain objects with relations in ROQ Console and define your permissions based on these objects.

[//]: # (TODO This needs more details)

*/}

{/*

Technically, the access management works based on a query plan which ROQ computes based on the current user's permissions and your database tables. The SDK is caching this information locally. This way, your application is independent of the availability of the ROQ Platform. Furthermore, there is no need to send all your data. ROQ only needs to know the schema of your database; the actual queries will be performed on your side.

{ /* You can use two functions of the SDK in your project: `hasAccess` and `buildQueryPlan`

## Check if a user has access to an object.

The `hasAccess` method returns `true` if a user has access to something; otherwise false.
You can use it for any object, whether it's an entity from your database, a URL, or a user interface component. See `hasAccess` SDK for more details.

*/}

## Filter Down Data of A Query

In the ROQ Club, the way you retrieve information about attendees from your database mimics the club's special entrance system. Think of the entrance system as our club's query plan.

For instance, consider you have a digital guest list named `/club-guests`. This list gives details about everyone currently enjoying the club. The entrance system (query plan) filters this list based on the type of membership card:

- An **Admin** cardholder (akin to club management) is granted full access to the list, seeing every guest present.
- A **VIP Member** cardholder can view a filtered list, featuring only those partying in the VIP lounge.
- A **Regular Member** cardholder is granted a more limited view, seeing details of just their group and perhaps a few acquaintances.

This dynamic filtering ensures that each member gets a personalized and secure experience in the club, just as tailored queries ensure that each user interacts with the data meant for them. The complexity of managing these multiple views and permissions is made simple through the club's entrance system, or in our technical terms, the **Query Plan**.

<Callout type="info">
For an in-depth dive into how ROQ Query Plan works, check out this [link](/access-management/query-plans).
</Callout>

{/*
When you retrieve data from your database, you'll often need to filter it by the user's role. For example, let’s say you have a REST endpoint called `/rented-cars` which returns a list of rented cars. Depending on the user's role, the result will be different: an _admin_ will see all the rented cars, while a _customer_ will see only their rented cars. This can result in complicated WHERE conditions, especially if you have more than these two simple roles.

{ /*
For this scenario, ROQ provides a query builder that automatically creates the required conditions. Using our ORM adapter, this can be easily integrated into your project. The generated queries can become quite complex if you have a deep schema. You can read more details about this method here: `buildQueryPlan` SDK

[//]: # (TODO buildQueryPlan link missing)
*/}

## Roles, Permissions, and Scopes

### Roles

Roles are assigned directly to users. You can easily read them in sentences like this:

* User Mary is an **admin**
* User Jane is a **chef**
* User John is a **driver**
* User Richard is a **customer**

A **role** is represented by its name, such as **owner**, **member**, **manager**, **chef**, **driver**, or **customer**.

<Callout type="info">
This [documentation](/access-management/roles) section explains more about roles on the ROQ Console. For a tutorial on how to assign or unassign roles from a user using ROQ's Node.js SDK API, read this [tutorial](/access-management/tutorials/user-roles-assignment).
</Callout>

### Permissions

**Permissions** determine the access level to a specific type of object. For instance, the role **manager** may be granted read access to the sales orders of a restaurant management application.

Permissions involve:

* The restricted entity (like `sales_order`),
* An operation (`read`, `create`, `update`, or `delete`),
* And a scope (`all`, `own`, or `tenant`).

#### Access Levels

To specify access levels for your application, select an object type (e.g., `salesOrder`). If the required object isn't available in the dropdown, it means it wasn't declared during the initial preparation.

For each object, you can set the following access levels:

| Level    | Description                                                 |
|----------|-------------------------------------------------------------|
| `Read`   | Permits the user to retrieve objects         |
| `Create` | Allows the user to create new objects of the chosen type |
| `Update` | Enables the user to modify objects of the chosen type    |
| `Delete` | Authorizes the user to remove objects of the chosen type    |


### Scopes

**Scope** determines the range of access within the permission. Scope the access levels are defined similarly.

Scopes:

| Scope    | Description                                                               |
|----------|---------------------------------------------------------------------------|
| `All`    | Grants the user access to all records                        |
| `Own`    | Limits the access to records directly associated with the user    |
| `Tenant` | Restricts the access to records associated with the user's tenant or organization |


<Callout type="info">
You will find the necessary information in the following two documents, regarding [platform permissions](/access-management/platform-permissions) and [project permissions](/access-management/project-permissions).
</Callout>

## API 

Use ROQ's [Access Management API](/access-management/api) for custom application development or to enhance generated application access management.


## Tutorials

These [tutorials](/access-management/tutorials) will explain many concepts and implementations of ROq's Access Management API, such as how to cache query plans, protect API routes, deactivate access management for development, etc.